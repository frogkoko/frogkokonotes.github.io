<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indonesian A/B Conversations - Family & Relationships</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #1a2a6c, #090327, #010b02);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .container {
            max-width: 900px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
            width: 100%;
        }
        .back-btn {
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.4);
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        .conversation-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            max-width: 700px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .conversation {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
        }
        .message {
            padding: 15px 20px;
            border-radius: 10px;
            max-width: 80%;
            word-wrap: break-word;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s;
            font-size: 1.1rem;
            line-height: 1.5;
        }
        .message:hover {
            transform: scale(1.02);
        }
        .message.a {
            align-self: flex-start;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border-bottom-left-radius: 0;
        }
        .message.b {
            align-self: flex-end;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            border-bottom-right-radius: 0;
        }
        .speak-btn {
            position: absolute;
            right: -30px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 0.9rem;
            color: #3498db;
        }
        .message.b .speak-btn {
            left: -30px;
            right: auto;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .control-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.4);
        }
        .control-btn.active {
            background: rgba(255, 255, 255, 0.6);
        }
        .instructions {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            max-width: 700px;
            width: 100%;
        }
        .instructions h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .instructions p {
            color: #34495e;
            margin-bottom: 10px;
            line-height: 1.5;
        }
        .voice-info {
            color: white;
            text-align: center;
            margin-bottom: 15px;
            font-size: 1rem;
            opacity: 0.9;
        }
        .vocab-highlight {
            background-color: #ffeb3b;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: bold;
            color: #333;
        }
        
        /* Test Section Styles */
        .test-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            max-width: 700px;
            width: 100%;
            display: none;
        }
        .test-container.active {
            display: block;
        }
        .test-title {
            text-align: center;
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 1.5rem;
        }
        .question {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .question-text {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .options {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .option {
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .option:hover {
            background: #e9ecef;
        }
        .option.selected {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
        }
        .option.correct {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }
        .option.incorrect {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        .test-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .test-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #3498db;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        .test-btn:hover {
            background: #2980b9;
        }
        .test-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        .results {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
            display: none;
        }
        .results.show {
            display: block;
        }
        .score {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .feedback {
            font-style: italic;
            color: #6c757d;
        }
        
        /* Loading indicator */
        .loading {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-left: 5px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="../../index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i>
            </a>
            <h1>Indonesian A/B Conversations - Family & Relationships</h1>
            <p class="subtitle">Practice Indonesian conversations with Audio Files</p>
        </header>
        
        <div class="voice-info">
            <p>Speaker A: Male voice | Speaker B: Female voice</p>
        </div>
        
        <div class="conversation-container">
            <div class="conversation" id="conversation">
                <!-- Messages will be added here dynamically -->
            </div>
        </div>
        
        <div class="test-container" id="test-container">
            <h2 class="test-title">Comprehension Test</h2>
            <div id="questions-container">
                <!-- Questions will be added here dynamically -->
            </div>
            <div class="test-controls">
                <button class="test-btn" id="prev-question-btn" disabled>Previous Question</button>
                <button class="test-btn" id="check-answer-btn">Check Answer</button>
                <button class="test-btn" id="next-question-btn">Next Question</button>
            </div>
            <div class="results" id="results">
                <div class="score" id="score-text"></div>
                <div class="feedback" id="feedback-text"></div>
            </div>
        </div>
        
        <div class="controls">
            <button class="control-btn" id="prev-btn">Previous</button>
            <button class="control-btn" id="next-btn">Next</button>
            <button class="control-btn" id="test-btn">Take Test</button>
            <button class="control-btn" id="reset-btn">Reset</button>
        </div>
        
        <div class="instructions">
            <h3>How to Use</h3>
            <p><strong>Click on a message</strong> to hear it spoken in Indonesian.</p>
            <p><strong>Speaker A</strong> uses a male voice, <strong>Speaker B</strong> uses a female voice.</p>
            <p><strong>Next/Previous:</strong> Navigate through the conversation.</p>
            <p><strong>Take Test:</strong> Test your understanding of the current conversation.</p>
            <p><strong>Reset:</strong> Start the conversation from the beginning.</p>
            <p><strong>Vocabulary:</strong> Key words are highlighted in yellow for easier learning.</p>
        </div>
    </div>
    <script>
        const conversations = [
            // Family Members Conversations
            [
                { speaker: 'a', text: "Ini adalah keluarga saya.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/ini_adalah_keluarga_m.mp3" },
                { speaker: 'b', text: "Siapa ayah Anda?", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/female/siapa_ayah_anda_f.mp3" },
                { speaker: 'a', text: "Ini ayah saya.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/ini_ayah_saya_m.mp3" }
            ],
            [
                { speaker: 'a', text: "Apakah ini ibu Anda?", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/apakah_ini_ibu_anda_m.mp3" },
                { speaker: 'b', text: "Ya, ini ibu saya.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/female/ya_ini_ibu_saya_f.mp3" },
                { speaker: 'a', text: "Ibu Anda sangat baik.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/ibu_anda_sangat_baik_m.mp3" }
            ],
            [
                { speaker: 'a', text: "Berapa saudara Anda?", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/berapa_saudara_anda_m.mp3" },
                { speaker: 'b', text: "Saya punya dua saudara.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/female/saya_punya_dua_saudara_f.mp3" },
                { speaker: 'a', text: "Apakah mereka kakak atau adik?", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/apakah_mereka_kakak_adik_m.mp3" },
                { speaker: 'b', text: "Satu kakak dan satu adik.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/female/satu_kakak_satu_adik_f.mp3" }
            ],
            [
                { speaker: 'a', text: "Apakah Anda punya kakak laki-laki?", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/punya_kakak_laki_m.mp3" },
                { speaker: 'b', text: "Tidak, saya punya kakak perempuan.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/female/tidak_punya_kakak_perempuan_f.mp3" },
                { speaker: 'a', text: "Oh, begitu.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/oh_begitu_m.mp3" }
            ],
            [
                { speaker: 'a', text: "Ini adalah anak saya.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/ini_anak_saya_m.mp3" },
                { speaker: 'b', text: "Anak laki-laki atau anak perempuan?", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/female/anak_laki_atau_perempuan_f.mp3" },
                { speaker: 'a', text: "Anak laki-laki.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/anak_laki_laki_m.mp3" },
                { speaker: 'b', text: "Dia sangat lucu.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/female/dia_sangat_lucu_f.mp3" }
            ],
            // Extended Family and Relationships
            [
                { speaker: 'a', text: "Apakah Anda punya kakek dan nenek?", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/punya_kakek_nenek_m.mp3" },
                { speaker: 'b', text: "Ya, mereka tinggal di desa.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/female/mereka_tinggal_desa_f.mp3" },
                { speaker: 'a', text: "Mereka pasti orang yang bijaksana.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/mereka_bijaksana_m.mp3" }
            ],
            [
                { speaker: 'a', text: "Siapa paman Anda?", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/siapa_paman_anda_m.mp3" },
                { speaker: 'b', text: "Ini paman saya, adik ayah saya.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/female/ini_paman_saya_f.mp3" },
                { speaker: 'a', text: "Senang bertemu dengan paman Anda.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/senang_bertemu_paman_m.mp3" }
            ],
            [
                { speaker: 'a', text: "Apakah Anda punya bibi?", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/punya_bibi_m.mp3" },
                { speaker: 'b', text: "Ya, saya punya dua bibi.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/female/punya_dua_bibi_f.mp3" },
                { speaker: 'a', text: "Mereka sangat ramah.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/mereka_ramah_m.mp3" }
            ],
            [
                { speaker: 'a', text: "Berapa sepupu Anda?", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/berapa_sepupu_m.mp3" },
                { speaker: 'b', text: "Saya punya banyak sepupu.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/female/punya_banyak_sepupu_f.mp3" },
                { speaker: 'a', text: "Keluarga Anda sangat besar.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/keluarga_besar_m.mp3" }
            ],
            [
                { speaker: 'a', text: "Apakah Anda sudah menikah?", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/sudah_menikah_m.mp3" },
                { speaker: 'b', text: "Ya, ini suami saya.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/female/ini_suami_saya_f.mp3" },
                { speaker: 'a', text: "Selamat, semoga bahagia selalu.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/selamat_bahagia_m.mp3" }
            ],
            // Politeness in Relationships
            [
                { speaker: 'a', text: "Boleh saya bertanya?", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/boleh_bertanya_m.mp3" },
                { speaker: 'b', text: "Tentu saja, silakan.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/female/tentu_silakan_f.mp3" },
                { speaker: 'a', text: "Terima kasih banyak.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/terima_kasih_banyak_m.mp3" }
            ],
            [
                { speaker: 'a', text: "Maaf mengganggu Anda.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/maaf_mengganggu_m.mp3" },
                { speaker: 'b', text: "Tidak mengganggu sama sekali.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/female/tidak_mengganggu_f.mp3" },
                { speaker: 'a', text: "Anda sangat baik hati.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/anda_baik_hati_m.mp3" }
            ],
            [
                { speaker: 'a', text: "Mohon maaf atas keterlambatan saya.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/mohon_maaf_terlambat_m.mp3" },
                { speaker: 'b', text: "Tidak apa-apa, jangan khawatir.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/female/tidak_apa_khawatir_f.mp3" },
                { speaker: 'a', text: "Terima kasih atas pengertian Anda.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/terima_kasih_pengertian_m.mp3" }
            ],
            [
                { speaker: 'a', text: "Tolong hormati keluarga saya.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/tolong_hormati_keluarga_m.mp3" },
                { speaker: 'b', text: "Tentu, saya akan menghormati mereka.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/female/akan_menghormati_f.mp3" },
                { speaker: 'a', text: "Terima kasih banyak.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/terima_kasih_banyak_m.mp3" }
            ],
            [
                { speaker: 'a', text: "Selamat atas pernikahan Anda.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/selamat_pernikahan_m.mp3" },
                { speaker: 'b', text: "Terima kasih, itu sangat manis dari Anda.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/female/terima_kasih_manis_f.mp3" },
                { speaker: 'a', text: "Semoga Anda berdua bahagia selamanya.", audioUrl: "https://github.com/frogkoko/indonesian-audio/raw/main/male/bahagia_selamanya_m.mp3" }
            ]
        ];

        // Test questions for each conversation
        const testQuestions = [
            // Family Members Tests
            [
                {
                    question: "What is Speaker A showing?",
                    options: [
                        "Their family",
                        "Their house",
                        "Their school",
                        "Their friend"
                    ],
                    correctAnswer: 0
                },
                {
                    question: "Who does Speaker B ask about?",
                    options: [
                        "Father",
                        "Mother",
                        "Brother",
                        "Sister"
                    ],
                    correctAnswer: 0
                }
            ],
            [
                {
                    question: "What is Speaker A asking about?",
                    options: [
                        "If this is Speaker B's mother",
                        "If this is Speaker B's father",
                        "If this is Speaker B's sister",
                        "If this is Speaker B's brother"
                    ],
                    correctAnswer: 0
                },
                {
                    question: "What does Speaker A say about Speaker B's mother?",
                    options: [
                        "She is very kind",
                        "She is very tall",
                        "She is very young",
                        "She is very smart"
                    ],
                    correctAnswer: 0
                }
            ],
            [
                {
                    question: "How many siblings does Speaker B have?",
                    options: [
                        "Two",
                        "One",
                        "Three",
                        "Four"
                    ],
                    correctAnswer: 0
                },
                {
                    question: "What is the combination of Speaker B's siblings?",
                    options: [
                        "One older and one younger sibling",
                        "Two older siblings",
                        "Two younger siblings",
                        "No siblings"
                    ],
                    correctAnswer: 0
                }
            ],
            [
                {
                    question: "What is Speaker A asking about?",
                    options: [
                        "If Speaker B has an older brother",
                        "If Speaker B has a younger brother",
                        "If Speaker B has an older sister",
                        "If Speaker B has a younger sister"
                    ],
                    correctAnswer: 0
                },
                {
                    question: "What does Speaker B have?",
                    options: [
                        "An older sister",
                        "An older brother",
                        "A younger sister",
                        "A younger brother"
                    ],
                    correctAnswer: 0
                }
            ],
            [
                {
                    question: "What is Speaker A showing?",
                    options: [
                        "Their child",
                        "Their parent",
                        "Their sibling",
                        "Their friend"
                    ],
                    correctAnswer: 0
                },
                {
                    question: "What does Speaker B say about the child?",
                    options: [
                        "He is very cute",
                        "He is very tall",
                        "He is very smart",
                        "He is very strong"
                    ],
                    correctAnswer: 0
                }
            ],
            // Extended Family Tests
            [
                {
                    question: "What is Speaker A asking about?",
                    options: [
                        "If Speaker B has grandparents",
                        "If Speaker B has parents",
                        "If Speaker B has siblings",
                        "If Speaker B has children"
                    ],
                    correctAnswer: 0
                },
                {
                    question: "Where do the grandparents live?",
                    options: [
                        "In the village",
                        "In the city",
                        "Overseas",
                        "In the mountains"
                    ],
                    correctAnswer: 0
                }
            ],
            [
                {
                    question: "Who is Speaker B's uncle?",
                    options: [
                        "Father's younger brother",
                        "Father's older brother",
                        "Mother's brother",
                        "Mother's father"
                    ],
                    correctAnswer: 0
                },
                {
                    question: "What does Speaker A say?",
                    options: [
                        "Nice to meet your uncle",
                        "Nice to meet your father",
                        "Nice to meet your mother",
                        "Nice to meet your brother"
                    ],
                    correctAnswer: 0
                }
            ],
            [
                {
                    question: "How many aunts does Speaker B have?",
                    options: [
                        "Two",
                        "One",
                        "Three",
                        "Four"
                    ],
                    correctAnswer: 0
                },
                {
                    question: "What does Speaker A say about them?",
                    options: [
                        "They are very friendly",
                        "They are very tall",
                        "They are very young",
                        "They are very smart"
                    ],
                    correctAnswer: 0
                }
            ],
            [
                {
                    question: "What is Speaker A asking about?",
                    options: [
                        "How many cousins Speaker B has",
                        "How many siblings Speaker B has",
                        "How many children Speaker B has",
                        "How many friends Speaker B has"
                    ],
                    correctAnswer: 0
                },
                {
                    question: "What does Speaker A say about Speaker B's family?",
                    options: [
                        "The family is very large",
                        "The family is very small",
                        "The family is very rich",
                        "The family is very poor"
                    ],
                    correctAnswer: 0
                }
            ],
            [
                {
                    question: "What is Speaker A asking?",
                    options: [
                        "If Speaker B is married",
                        "If Speaker B has children",
                        "If Speaker B is single",
                        "If Speaker B is engaged"
                    ],
                    correctAnswer: 0
                },
                {
                    question: "What does Speaker A say?",
                    options: [
                        "Congratulations, may you always be happy",
                        "Nice to meet you",
                        "Thank you very much",
                        "Goodbye"
                    ],
                    correctAnswer: 0
                }
            ],
            // Politeness Tests
            [
                {
                    question: "What is Speaker A asking permission for?",
                    options: [
                        "To ask a question",
                        "To leave",
                        "To sit down",
                        "To eat"
                    ],
                    correctAnswer: 0
                },
                {
                    question: "What does Speaker B say?",
                    options: [
                        "Of course, please",
                        "No, you can't",
                        "Maybe later",
                        "I don't know"
                    ],
                    correctAnswer: 0
                }
            ],
            [
                {
                    question: "What is Speaker A apologizing for?",
                    options: [
                        "Disturbing Speaker B",
                        "Being late",
                        "Being rude",
                        "Making a mistake"
                    ],
                    correctAnswer: 0
                },
                {
                    question: "What does Speaker A say about Speaker B?",
                    options: [
                        "You are very kind-hearted",
                        "You are very smart",
                        "You are very tall",
                        "You are very young"
                    ],
                    correctAnswer: 0
                }
            ],
            [
                {
                    question: "What is Speaker A apologizing for?",
                    options: [
                        "Being late",
                        "Being rude",
                        "Making noise",
                        "Making a mess"
                    ],
                    correctAnswer: 0
                },
                {
                    question: "What does Speaker B say?",
                    options: [
                        "It's okay, don't worry",
                        "You should be ashamed",
                        "This is unacceptable",
                        "Please leave"
                    ],
                    correctAnswer: 0
                }
            ],
            [
                {
                    question: "What does Speaker A ask Speaker B to do?",
                    options: [
                        "Respect their family",
                        "Visit their family",
                        "Meet their family",
                        "Call their family"
                    ],
                    correctAnswer: 0
                },
                {
                    question: "What does Speaker B promise?",
                    options: [
                        "To respect them",
                        "To visit them",
                        "To call them",
                        "To help them"
                    ],
                    correctAnswer: 0
                }
            ],
            [
                {
                    question: "What is Speaker A congratulating Speaker B for?",
                    options: [
                        "Their marriage",
                        "Their birthday",
                        "Their promotion",
                        "Their graduation"
                    ],
                    correctAnswer: 0
                },
                {
                    question: "What does Speaker A wish for the couple?",
                    options: [
                        "To be happy forever",
                        "To be rich",
                        "To have children",
                        "To travel the world"
                    ],
                    correctAnswer: 0
                }
            ]
        ];

        // Indonesian vocabulary to highlight
        const vocabWords = [
            "keluarga", "ayah", "ibu", "saudara", "kakak", "adik", 
            "laki-laki", "perempuan", "anak", "punya", "Ini", "adalah",
            "Siapa", "Apakah", "Berapa", "dua", "satu", "Ya", "Tidak",
            "Boleh", "Maaf", "Terima kasih", "Tolong", "Mohon", "Selamat",
            "baik", "lucu", "sangat", "banyak", "atau", "dan", "kakek",
            "nenek", "paman", "bibi", "sepupu", "tinggal", "desa", "bijaksana",
            "ramah", "besar", "menikah", "suami", "istri", "bahagia", "selalu",
            "bertanya", "silakan", "mengganggu", "sama sekali", "hati",
            "keterlambatan", "khawatir", "pengertian", "hormati", "menghormati",
            "pernikahan", "manis", "berdua", "selamanya", "Senang", "bertemu",
            "dengan", "Anda", "saya", "mereka", "Dia", "Begitu", "Tentu"
        ];

        let currentConversationIndex = 0;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let testStarted = false;
        let audio = new Audio();
        
        const conversationElement = document.getElementById('conversation');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const resetBtn = document.getElementById('reset-btn');
        const testBtn = document.getElementById('test-btn');
        const testContainer = document.getElementById('test-container');
        const questionsContainer = document.getElementById('questions-container');
        const prevQuestionBtn = document.getElementById('prev-question-btn');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        const checkAnswerBtn = document.getElementById('check-answer-btn');
        const results = document.getElementById('results');
        const scoreText = document.getElementById('score-text');
        const feedbackText = document.getElementById('feedback-text');
        
        // Function to highlight vocabulary words
        function highlightVocabulary(text) {
            let highlightedText = text;
            vocabWords.forEach(word => {
                const regex = new RegExp(word, 'gi');
                highlightedText = highlightedText.replace(regex, `<span class="vocab-highlight">${word}</span>`);
            });
            return highlightedText;
        }

        function renderConversation() {
            conversationElement.innerHTML = '';
            const currentConversation = conversations[currentConversationIndex];
            
            currentConversation.forEach(message => {
                const messageElement = document.createElement('div');
                messageElement.className = `message ${message.speaker}`;
                
                // Highlight vocabulary words
                const highlightedText = highlightVocabulary(message.text);
                
                messageElement.innerHTML = `
                    ${highlightedText}
                    <button class="speak-btn" data-audio="${message.audioUrl}">
                        <i class="fas fa-volume-up"></i>
                    </button>
                `;
                conversationElement.appendChild(messageElement);
            });
            
            // Add event listeners to speak buttons
            document.querySelectorAll('.speak-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const audioUrl = e.target.closest('.speak-btn').dataset.audio;
                    playAudio(audioUrl, e.target.closest('.speak-btn'));
                });
            });
            
            // Add event listeners to messages
            document.querySelectorAll('.message').forEach(message => {
                message.addEventListener('click', (e) => {
                    if (!e.target.closest('.speak-btn')) {
                        const audioUrl = e.currentTarget.querySelector('.speak-btn').dataset.audio;
                        playAudio(audioUrl, e.currentTarget.querySelector('.speak-btn'));
                    }
                });
            });
        }

        function playAudio(audioUrl, button) {
            // Stop any currently playing audio
            audio.pause();
            
            // Remove loading indicators from all buttons
            document.querySelectorAll('.speak-btn').forEach(btn => {
                const icon = btn.querySelector('i');
                const loading = btn.querySelector('.loading');
                if (loading) {
                    btn.removeChild(loading);
                }
                icon.style.display = 'inline-block';
            });
            
            // Show loading indicator on clicked button
            const icon = button.querySelector('i');
            icon.style.display = 'none';
            const loading = document.createElement('span');
            loading.className = 'loading';
            button.appendChild(loading);
            
            // Set up the audio
            audio.src = audioUrl;
            audio.oncanplaythrough = () => {
                // Remove loading indicator when ready to play
                const loading = button.querySelector('.loading');
                if (loading) {
                    button.removeChild(loading);
                }
                icon.style.display = 'inline-block';
            };
            audio.onerror = () => {
                // Remove loading indicator on error
                const loading = button.querySelector('.loading');
                if (loading) {
                    button.removeChild(loading);
                }
                icon.style.display = 'inline-block';
                alert('Error loading audio. Please try again.');
            };
            
            // Play the audio
            audio.play();
        }

        function startTest() {
            testStarted = true;
            currentQuestionIndex = 0;
            userAnswers = new Array(testQuestions[currentConversationIndex].length).fill(null);
            testContainer.classList.add('active');
            renderQuestion();
            updateTestControls();
            results.classList.remove('show');
        }

        function renderQuestion() {
            questionsContainer.innerHTML = '';
            const questions = testQuestions[currentConversationIndex];
            const question = questions[currentQuestionIndex];
            
            const questionElement = document.createElement('div');
            questionElement.className = 'question';
            questionElement.innerHTML = `
                <div class="question-text">${currentQuestionIndex + 1}. ${question.question}</div>
                <div class="options">
                    ${question.options.map((option, index) => `
                        <div class="option ${userAnswers[currentQuestionIndex] === index ? 'selected' : ''}" data-index="${index}">
                            ${option}
                        </div>
                    `).join('')}
                </div>
            `;
            
            questionsContainer.appendChild(questionElement);
            
            // Add event listeners to options
            document.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', () => {
                    // Remove selected class from all options
                    document.querySelectorAll('.option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Add selected class to clicked option
                    option.classList.add('selected');
                    
                    // Store user's answer
                    userAnswers[currentQuestionIndex] = parseInt(option.dataset.index);
                    
                    // Enable check answer button
                    checkAnswerBtn.disabled = false;
                });
            });
        }

        function updateTestControls() {
            prevQuestionBtn.disabled = currentQuestionIndex === 0;
            nextQuestionBtn.disabled = currentQuestionIndex === testQuestions[currentConversationIndex].length - 1;
            checkAnswerBtn.disabled = userAnswers[currentQuestionIndex] === null;
        }

        function checkAnswer() {
            const questions = testQuestions[currentConversationIndex];
            const question = questions[currentQuestionIndex];
            const userAnswer = userAnswers[currentQuestionIndex];
            
            // Show correct/incorrect styling
            document.querySelectorAll('.option').forEach(option => {
                const index = parseInt(option.dataset.index);
                if (index === question.correctAnswer) {
                    option.classList.add('correct');
                } else if (index === userAnswer && userAnswer !== question.correctAnswer) {
                    option.classList.add('incorrect');
                }
            });
            
            // Disable further selection
            document.querySelectorAll('.option').forEach(option => {
                option.style.pointerEvents = 'none';
            });
            
            checkAnswerBtn.disabled = true;
            
            // If this is the last question, show results
            if (currentQuestionIndex === questions.length - 1) {
                showResults();
            }
        }

        function showResults() {
            const questions = testQuestions[currentConversationIndex];
            let correctCount = 0;
            
            questions.forEach((question, index) => {
                if (userAnswers[index] === question.correctAnswer) {
                    correctCount++;
                }
            });
            
            const score = Math.round((correctCount / questions.length) * 100);
            scoreText.textContent = `Your Score: ${score}% (${correctCount}/${questions.length})`;
            
            // Provide feedback based on score
            if (score >= 90) {
                feedbackText.textContent = "Excellent! You have a great understanding of this conversation.";
            } else if (score >= 70) {
                feedbackText.textContent = "Good job! You understood most of the conversation.";
            } else if (score >= 50) {
                feedbackText.textContent = "Not bad! Review the conversation and try again.";
            } else {
                feedbackText.textContent = "Keep practicing! Listen to the conversation again and pay attention to the details.";
            }
            
            results.classList.add('show');
        }

        // Event listeners for conversation navigation
        prevBtn.addEventListener('click', () => {
            if (currentConversationIndex > 0) {
                currentConversationIndex--;
                renderConversation();
                testContainer.classList.remove('active');
                testStarted = false;
            }
        });

        nextBtn.addEventListener('click', () => {
            if (currentConversationIndex < conversations.length - 1) {
                currentConversationIndex++;
                renderConversation();
                testContainer.classList.remove('active');
                testStarted = false;
            }
        });

        resetBtn.addEventListener('click', () => {
            currentConversationIndex = 0;
            renderConversation();
            testContainer.classList.remove('active');
            testStarted = false;
        });

        testBtn.addEventListener('click', () => {
            startTest();
        });

        // Event listeners for test navigation
        prevQuestionBtn.addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
                updateTestControls();
            }
        });

        nextQuestionBtn.addEventListener('click', () => {
            if (currentQuestionIndex < testQuestions[currentConversationIndex].length - 1) {
                currentQuestionIndex++;
                renderQuestion();
                updateTestControls();
            }
        });

        checkAnswerBtn.addEventListener('click', checkAnswer);

        // Initial render
        renderConversation();
    </script>
</body>
</html>